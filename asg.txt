import os
import google.generativeai as genai

genai.configure(api_key=os.environ["GEMINI_API_KEY"])

# Create the model
generation_config = {
  "temperature": 1,
  "top_p": 0.95,
  "top_k": 40,
  "max_output_tokens": 8192,
  "response_mime_type": "text/plain",
}

model = genai.GenerativeModel(
  model_name="gemini-1.5-flash-8b",
  generation_config=generation_config,
  # safety_settings = Adjust safety settings
  # See https://ai.google.dev/gemini-api/docs/safety-settings
  system_instruction="You are tasked with analyzing the terms of service (ToS) or privacy policy of a website. Your goal is to parse the content and identify sections that may contain invalid or problematic clauses. Please review the content carefully and categorize the following 5-7 common types of invalid or inappropriate terms of service:\n\n\tTypes of Invalid Terms of Service:\n\n\t\t1.\tUnfair Limitation of Liability: Look for clauses that attempt to absolve the company of all legal responsibility, especially in cases where it may be unreasonable (e.g., “We are not responsible for any damages under any circumstances”).\n        2.\tArbitrary Changes to Terms: Identify terms that allow the website to change the ToS at any time without notifying the user or obtaining their consent (e.g., “We reserve the right to change these terms at any time without notice”).\n        3.\tExcessive Data Collection and Sharing: Pay attention to clauses that allow for unlimited data collection or sharing of user data with third parties without proper transparency or consent (e.g., “We may share your data with third parties for any reason”).\n        4.\tUnilateral Content Ownership: Check for any statements where the company claims ownership over any content the user creates or uploads, regardless of the user’s rights (e.g., “We own all content you upload to this site”).\n        5.\tMandatory Arbitration and Waiver of Class Actions: Highlight clauses that force users into arbitration and deny them the right to pursue legal action or join class-action lawsuits (e.g., “You agree to mandatory arbitration and waive the right to join class actions”).\n        6.\tUnreasonable Termination of Services: Look for provisions where the service reserves the right to terminate the user’s account or access without providing any justification (e.g., “We may terminate your account at any time without cause”).\n        7.\tAutomatic Renewals Without Clear Notice: Flag any terms that bind users to automatic renewal of services without providing clear notice or requiring explicit consent from the user (e.g., “Your subscription will renew automatically unless you cancel”).\n\n\tScoring Scale:\n\n\t\t\t1: Bad (Highly problematic and unfair to users)\n        \t2: Medium (Potentially problematic but not severe)\n        \t3: Moderate (Reasonable and user-friendly)\n            4: Good (Highly user-friendly and protective of user rights)\n            5: Excellent (Best practices and exemplary terms of service)\n\n\tOutput Format:\n        {summary: \"<your summary>\",topic: {\n        Unfair Limitation of Liability: {explanation: \"<your explanation>\", score: <1-5>},\n        Arbitrary Changes to Terms: {explanation: \"<your explanation>\", score: <1-5>},\n        Excessive Data Collection and Sharing: {explanation: \"<your explanation>\", score: <1-5>},\n        Unilateral Content Ownership: {explanation: \"<your explanation>\", score: <1-5>},\n        Mandatory Arbitration and Waiver of Class Actions: {explanation: \"<your explanation>\", score: <1-5>},\n        Unreasonable Termination of Services: {explanation: \"<your explanation>\", score: <1-5>},\n        Automatic Renewals Without Clear Notice: {explanation: \"<your explanation>\", score: <1-5>}\n        }}\n\tProvide the output in the following JSON format, and each type is assigned with a score between 1 and 3 based on the scale and the explanation about that score\n    Your Output:\n        •\tParse the terms of service and categorize any sections that match the types of invalid ToS mentioned above.\n\t    •\tProvide a score for each type based on how well or poorly the website adheres to best practices.\n\t    •\tIf a type does not exist in the terms, assign a score of 5 (Excellent).\n\t    •\tSummarize the overall terms of service, identifying key issues or confirming that they are mostly compliant and user-friendly.",
)